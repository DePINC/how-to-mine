# Timelord

DePINC consensus incorporates both Space and Time proofs. Space proofs are derived from plots, while Time proofs are generated by Timelord. The Timelord component provides time proofs to enhance the security of the DePINC network, creating a robust dual-proof system that strengthens overall blockchain integrity.

Running a Timelord is optional for DePINC mining, but highly recommended for all miners to operate locally. This practice enhances the integrity of the entire DePINC network and enables your local miner to obtain time-proofs promptly. By running a Timelord, you contribute to network security while potentially improving your mining efficiency through faster access to essential time-proofs.

## Get Timelord

The official Timelord source code is available at [https://github.com/depinc/timelord](https://github.com/depinc/timelord). Visit the GitHub page for detailed information on compiling and optimizing Timelord for your specific environment.

## Get chiavdf

Chiavdf is a project developed by Chia Network that generates basic time-proofs and provides proof results. Timelord requires these results to generate the final time-proof for DePINC consensus. The integration of chiavdf enhances the security and reliability of the DePINC network by incorporating verifiable time-based calculations into the consensus mechanism.

VDF = verifiable delay function

Chiavdf is available at [https://github.com/chia-network/chiavdf](https://github.com/chia-network/chiavdf). You can compile it on Linux or macOS systems. An executable VDF program is required to run Timelord.

## Test the vdf calculation speed of the computer

To test the VDF (Verifiable Delay Function) calculation speed of your computer:

1. Locate the `vdf_bench` executable in the `chiavdf/src` directory if you've compiled the chiavdf project.

2. Run the following command:
   ```
   vdf_bench square_asm 250000
   ```

3. This command performs a specified number of VDF calculations and displays the results in iterations per second (ips).

Example benchmarks:
- MacBook Pro A1707: ~150k ips
- 10-year-old PC: ~130k ips
- i5 10600KF: ~200k ips

Higher ips values indicate faster VDF calculation speeds, which can be beneficial for DePINC mining performance.

## Start Timelord

Timelord can be compiled and run under Linux. If you use Windows operating system, please refer to the content of the chapter "Running Locally Using Docker".

Please go to (https://depinc.org) related page to download the compiled Linux package, and decompress the files in it to the runnable directory, usually `/usr/local/bin`. There are three executable files unpacked, namely: timelord, vdf_client, vdf_bench. Among them, timelord is the main executable file, used to execute timelord service, vdf_client is called by timelord to get vdf answers, vdf_bench is used to test the speed of getting vdf answers on the current computer.

The workflow of timelord is as follows: First, timelord connects to the RPC service of the node wallet through socket, and queries the latest challenge in the current network through the node wallet. At the same time, miner can connect to timelord and request calculation from timelord. Timelord will check the challenge in the miner's request, if it is consistent with the challenge in the current network and the relevant calculation has not started, it will start the calculation. Multiple miners request different iters values, so when the answer for a certain iters is calculated, it will be directly returned to the corresponding miner through socket. If the latest block of the node wallet has changed, the current calculation needs to be stopped and prepare to start the next calculation service.

Using `--help` can get the help information of the timelord command. The timelord command is mainly divided into: node wallet connection parameters, miner service parameters and vdf_client related parameters.

```bash
Timelord, run vdf and returns proofs
Usage:
  Timelord [OPTION...]

      --help                 Show help document
      --logfile arg          Store logs into file (default: ./timelord.log)
  -v, --verbose              Show more logs
      --addr arg             Listening to address (default: 127.0.0.1)
      --port arg             Listening on this port (default: 19191)
      --vdf_client-path arg  The full path to `vdf_client` (default:
                             $HOME/chiavdf/src/vdf_client)
      --vdf_client-addr arg  vdf_client will listen to this address
                             (default: 127.0.0.1)
      --vdf_client-port arg  vdf_client will listen to this port (default:
                             29292)
      --rpc arg              The endpoint of depinc core (default:
                             http://127.0.0.1:18732)
      --cookie arg           Full path to the `.cookie` file generated by
                             depinc core (default:
                             $HOME/.depinc/testnet3/.cookie)
      --rpc-user arg         The username to identify RPC connection
      --rpc-password arg     The password to verify RPC connection
```

The parameter that needs attention first is `--vdf_client-path`, which specifies the full path where your vdf_client is located. Secondly, you need to specify the RPC connection address of the node wallet, use the parameter `--rpc` to specify the connection destination. Note that if your node program has not set a username and password, you need to specify the location of `.cookie`, otherwise please use `--rpc-user` and `--rpc-password` to specify the username and password.

#### Run locally using Docker

First download and install Docker, related information can be found at (https://docker.io). After installing Docker, you can enter docker in the command line window to execute related commands. At this time, you can execute the command: `docker pull DEPCone/timelord` to download the compiled docker package to the local. For convenience, this image package contains timelord, vdf_client and vdf_bench at the same time.

First, you need to configure the node wallet so that its RPC service needs to log in with a username and password. Add parameters: `-rpcuser=hello`, and `-rpcpassword=world`, which sets the login username and password for the RPC service.

Then, enter the following command in the command line window to start the timelord in the Docker image. Note to modify the parameters related to username and password to the values you set earlier. The following command will open port 19191 locally for the local miner program to connect. If you need to listen to 0.0.0.0, please modify the corresponding parameters. For instructions on using Docker parameters, you can look it up on (https://docker.io) yourself, so I won't go into details here.

```bash
> docker run --add-host host.docker.internal:host-gateway -p 127.0.0.1:19191:19191
    -it DEPCone/timelord /timelord --rpc=http://host.docker.internal:18732
    --rpc-user=hello --rpc-password=world
    --vdf_client-path=/vdf_client
    --bind=0.0.0.0 --port=19191
```

Note: In the above command, the started timelord will listen to the 127.0.0.1 address of the local machine. If your miner program needs to connect to this timelord on another machine, you need to change "127.0.0.1" to "0.0.0.0" in the first line of the above command.

#### Connect to Docker version of Timelord

According to the above Timelord startup command, Timelord has already listened to port 19191, so using Miner to connect to Timelord can use the command `miner --timelord --timelord-host=127.0.0.1 --timeload-port=19191`

## Q/A

Q: What is time proof?

A: The DePINC upgrade incorporates both Chia's PoS capacity proof and PoT time proof. Time proof results enhance network security and prevent block forgery. When generating a new block, miners must include one or more time proof results, which are obtained by running a time proof calculator. This dual-proof system strengthens the overall integrity and reliability of the DePINC network.

Q: Do I need to run a time proof calculator?

A: While running a time proof calculator locally is optional, it offers significant advantages:

1. Faster results: Local calculations provide the quickest access to time proofs.
2. Improved block generation: Rapid proof acquisition enhances your ability to generate blocks efficiently.
3. Reduced network dependency: You avoid relying on the P2P network for proof requests.
4. Minimized delays: Local computation eliminates potential latency issues that could hinder block generation.
5. Increased reliability: You're not subject to network fluctuations or unavailable remote nodes.

Timelord is a bridge program used to execute `vdf_client` and obtain calculation results and return them to the requestor. The requestor can be a node wallet or a mining client. Directly using miner to connect with Timelord has the following advantages:

- Not dependent on the node wallet, directly connected to Miner through socket, the obtained results are directly returned to Miner for block packaging;
- Results are no longer uploaded to the P2P network, no longer causing too many data packets in the P2P network;
- It is compiled and packaged into a Docker container, making it possible to run directly under Windows, and Windows miners can also obtain vdf calculation results through it;
- The DePINC community will also launch public timelord services for users who do not run timelord to obtain vdf proof results;

If you choose not to run a local time proof calculator, you'll need to request proofs through the P2P network from other nodes. This approach may lead to delays or even prevent block generation due to network latency or unavailability of proof-providing nodes.

Q: How Miner connects to Timelord

A: There are three parameters in Miner used to specify the timelord service it needs to connect to, namely: `--timelord`, `--timelord-host`, `--timelord-port`. The first parameter indicates the need to connect with timelord to obtain vdf answers, and the latter two parameters specify the connection address and port of timelord respectively.
